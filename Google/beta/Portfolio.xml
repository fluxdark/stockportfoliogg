<?xml version="1.0" encoding="UTF-8" ?>
  <Module>
  <ModulePrefs title="__MSG_gadgettitle__" description="Highly configurable list with unlimited number of stocks, options, ETFs. See chart and details for each stock. Calculate total value, earning and much more in your local currency." directory_title="Stock portfolio" scrolling="false" singleton="false" scaling="true" height="250" thumbnail="http://stockportfoliogg.googlecode.com/svn/released/images/StockPortfolioThumb.png" screenshot="http://stockportfoliogg.googlecode.com/svn/released/images/StockPortfolio.png" author="Christian Nybroe" author_email="cnybroe.feedback+Stockgadget@gmail.com" author_affiliation="Personal" author_location="Taasinge, Denmark" author_link="http://sites.google.com/site/cnybroe/iGoogleStockGadget" category="finance">
    <Locale messages="http://stockportfoliogg.googlecode.com/svn/released/locale/ALL_ALL.xml"/>
    <Locale lang="da" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/da_ALL.xml"/>
    <Locale lang="es" messages="http://stockportfoliogg.googlecode.com/svn/beta/locale/es_ALL.xml"/>
    <Locale lang="fr" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/fr_ALL.xml"/>
    <Locale lang="it" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/it_ALL.xml"/>
    <Locale lang="sv" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/sv_ALL.xml"/>
    <Locale lang="pt-PT" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/pt_PT.xml"/>
    <Locale lang="pt-BR" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/pt_BR.xml"/>
    <Locale lang="de" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/de_ALL.xml"/>
    <Locale lang="nl" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/nl_ALL.xml"/>
    <Locale lang="zh-TW" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/zh_TW.xml"/>
    <Require feature="finance"/>
    <Require feature="setprefs"/>
    <Require feature="minimessage"/>
    <Require feature="analytics"/>
    <Require feature="dynamic-height"/>
    <Require feature="settitle"/>
  </ModulePrefs> 
  <UserPref name="StockTickers" datatype="hidden" default_value=""/>
  <UserPref name="StockQtys" datatype="hidden" default_value=""/>
  <UserPref name="StockPrices" datatype="hidden" default_value=""/>
  <UserPref name="StockTC" datatype="hidden" default_value=""/>
  <UserPref name="StockHi" datatype="hidden" default_value=""/>
  <UserPref name="StockLo" datatype="hidden" default_value=""/>
  
  <Content type="html" view="home,canvas,preview">
    <![CDATA[
  
  <style type="text/css">
    .Loading{font-family:sans-serif;foreground:#666666;font-style:italic;font-size:11px;}
    .Footer{font-size:9px;font-family:sans-serif;padding:0px;margin:0px;}
    .HrDef{height:1px;margin-top:1px;margin-bottom:1px;margin-right:0px;margin-left:0px;}
  </style>

  <div id="promo"></div>
  <div id="StockData"><div class="Loading">__MSG_initialloading__</div></div>
  <div id="Footer" class="Footer"></div>

  <div id="disclaimer" nowrap><hr class="HrDef"><table border=0 cellspacing=0 cellpadding=0 width="100%"><tr><td valign="middle" class="Footer" nowrap width="10%"><a href="http://sites.google.com/site/cnybroe/iGoogleStockGadget/disclaimer" target="_blank">Stock data, news and historical charts provided by </a></td><td><img width="16" height="16" border=0 alt="Yahoo" title="Yahoo" src="http://stockportfoliogg.googlecode.com/svn/released/images/Yahoo.gif"></td><td id="gVersion" nowrap valign="middle" align="right" width="90%" class="Footer">Version</td></tr></table></div>
  <div id="debug" nowrap style="display:none;font-size:9pt;padding:5px;color:red;width:100%;height:200px;overflow:scroll"></div> 

   
  <script language="javascript" type="text/javascript" defer="defer">
    var pref=new gadgets.Prefs(__MODULE_ID__);
    var debug=1;

    //Search: http://www.google.com/finance/match?matchtype=matchall&q=abb
    //News: http://www.google.com/finance/company_news?q=NASDAQ:GOOG&output=rss
    //Image: http://www.google.com/finance/chart?cht=c&q=goog&p=1m&tlf=24h

   //This defines the Stock object:
    Stock.prototype.value=function(){return this.qty*this.price;};
    function Stock(index,ticker,qty,price,hiLim,loLim) 
    {
      this.index = index;
      this.ticker = ticker;
      this.qty = qty;
      this.price = price;
      this.hiLim = hiLim;
      this.loLim = loLim;
      this.last = 0;
      this.high = 0;
      this.low = 0;
      this.open = 0;
      this.chg = 0;
      this.chgPct = 0;
      this.volume = 0;
      this.exchange = "";
      this.tradeDateTime = "";
      this.updated = 0;
      if (this.last>this.hi){OnHi(this.index);}
      if (this.last<this.lo){OnLo(this.index);}
    }

    function OnHi(i)
    {
      //msg('Hi limit passed on index: '+i);
    }
    
    function OnLo(i)
    {
      //msg('Lo limit passed on index: '+i);
    }
    
    //Create stocks collection
    Array.prototype.Add=function(ticker,qty,price,hi,lo){this[index++] = new Stock(index,ticker,qty,price,hi,lo);};
    Array.prototype.GetTickers=function(){var n = [];for(var i=0;i<this.length;i++){n[i]=Stocks[i].ticker;}return n;};
    Array.prototype.GetStockByTickerName=function(name){for(var i=0;i<this.length;i++){if(Stocks[i].ticker==name && Stocks[i].updated==0){return Stocks[i];}}};
    Array.prototype.UpdateStocks=function(){for(var i=0;i<this.length;i++){Stocks[i].updated=0;}fnReqStockData();};
    var Stocks = [];
    var index = 0;

    function fnInit()
    {
        //document.getElementById("gVersion").innerHTML='Version:'+iVersion;
        fnReadPrefs();
        fnLoad();
        //setTimeout('fnMessage();_IG_Analytics("UA-2031644-1", "/Portfolio")',2000);
    }
     
    function fnReqStockData()
    {
        var quote = new google.finance.Quote();
        quote.getQuotes(Stocks.GetTickers());
        quote.addListener(fnRecvStockData);	  
    }

    function fnRecvStockData(data)
    {
        //print("TICKER: " + data[google.finance.TICKER]);
        //Check that tickers always are retured in same order as reuested
        //print(Stocks.GetStockByTickerName(data[google.finance.TICKER]).ticker);

        var a = Stocks.GetStockByTickerName(data[google.finance.TICKER]);
        //if (a != "undefined")
        //{
            a.last = data[google.finance.LAST];
            a.high = data[google.finance.HIGH];
            a.low = data[google.finance.LOW];
            a.open = data[google.finance.OPEN];
            a.chg = data[google.finance.CHANGE];
            a.chgPct = data[google.finance.CHANGE_PCT];
            a.exchange = data[google.finance.EXCHANGE];
            a.volume = data[google.finance.VOLUME];
            a.tradeDateTime = data[google.finance.LAST_TRADE_DATETIME];    
            a.updated = 1;   
            print(a.ticker + ": " + a.last);
        //} 
        //else
        //{
        //    alert("dfdsfsd");
        //    print(data[google.finance.TICKER] + " not found in stocks object !!!");
        //}
    }


    function fnSavePrefs()
    {
//        var arrStock = ['0,100,20,80','1,101,21,81','2,102,22,82'];
//        var arrStocks= [arrStock[0],arrStock[1],arrStock[2]];

//        for(i=0;iprefLen;i++)

//        pref.set("Stocks",);
    }

    function fnReadPrefs(){
        var arrStocks = [];
        //var prefStr = pref.getString("Stocks");
        var prefStr = "GOOG,0,100,20,80;MFST,1,101,21,81;FCX,2,102,22,82;GOOG,1,101,21,81";
        
        var arrStocks = prefStr.split(";");
        var prefLen = arrStocks.length;
        for(var i=0;i<prefLen;i++)
        {
            arrStocks[i]=arrStocks[i].split(",");
            Stocks.Add(arrStocks[i][0],arrStocks[i][1],arrStocks[i][2],arrStocks[i][3],arrStocks[i][4]);
        }

   
    //iPrefVersion=pref.getString("GadgetVersion");
  }

  function fnLoad(){
    //fnPrefsValidation(arrStockSymbols);
    Stocks.UpdateStocks();
    //fnInsertTables();
  }


  function fnZeroPad(num,length)
  {
    var snum = num + '';
    while(snum.length < length)
    {
      snum = '0' + snum; 
    }
    return snum;
  }

  function trim(s)
  {
    if (s)
    {
      return s.replace(/^\s*/,"").replace(/\s*$/,"");
    }
    else
    {
      return "";
    }
  }

  function fngetDate(secs)
  {
    var currentTime=new Date();
    var month=fnZeroPad(currentTime.getMonth()+1,2);
    var day=fnZeroPad(currentTime.getDate(),2);
    var year=currentTime.getFullYear();
    var hours=fnZeroPad(currentTime.getHours(),2);
    var minutes=fnZeroPad(currentTime.getMinutes(),2);
    if(secs){minutes+=':'+fnZeroPad(currentTime.getSeconds(),2);}
    return year+'-'+month+'-'+day+' '+hours+':'+minutes;
  }

  function print(msg)
  {
    if (debug==1)
    {
      var debug_html = document.getElementById("debug").innerHTML;
      if (document.getElementById("debug").style.display=='none')
      {
        document.getElementById("debug").style.display='block';
        gadgets.window.adjustHeight();   
      }
      msg=fngetDate(1)+"; "+msg.toString()+"<br>";
      debug_html=msg+debug_html;
      document.getElementById("debug").innerHTML=debug_html;
    }
  }



    //1-2-3 start
    fnInit();  

    </script>
    ]]>
    </Content>
  </Module>