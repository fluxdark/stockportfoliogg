<?xml version="1.0" encoding="UTF-8" ?>
  <Module>
  <ModulePrefs title="__MSG_gadgettitle__" description="Highly configurable list with unlimited number of stocks, options, ETFs. See chart and details for each stock. Calculate total value, earning and much more in your local currency." directory_title="Stock portfolio" scrolling="false" singleton="false" scaling="true" height="250" thumbnail="http://stockportfoliogg.googlecode.com/svn/Google/released/images/StockPortfolioThumb.png" screenshot="http://stockportfoliogg.googlecode.com/svn/Google/released/images/StockPortfolio.png" author="Christian Nybroe" author_email="cnybroe.feedback+Stockgadget@gmail.com" author_affiliation="Personal" author_location="Taasinge, Denmark" author_link="http://sites.google.com/site/cnybroe/iGoogleStockGadget" category="finance">
    <Locale messages="http://stockportfoliogg.googlecode.com/svn/released/locale/ALL_ALL.xml"/>
    <Locale lang="da" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/da_ALL.xml"/>
    <Locale lang="es" messages="http://stockportfoliogg.googlecode.com/svn/beta/locale/es_ALL.xml"/>
    <Locale lang="fr" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/fr_ALL.xml"/>
    <Locale lang="it" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/it_ALL.xml"/>
    <Locale lang="sv" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/sv_ALL.xml"/>
    <Locale lang="pt-PT" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/pt_PT.xml"/>
    <Locale lang="pt-BR" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/pt_BR.xml"/>
    <Locale lang="de" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/de_ALL.xml"/>
    <Locale lang="nl" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/nl_ALL.xml"/>
    <Locale lang="zh-TW" messages="http://stockportfoliogg.googlecode.com/svn/released/locale/zh_TW.xml"/>
    <Require feature="finance"/>
    <Require feature="setprefs"/>
    <Require feature="minimessage"/>
    <Require feature="analytics"/>
    <Require feature="dynamic-height"/>
    <Require feature="settitle"/>
  </ModulePrefs>
  <UserPref name="GadgetVersion" datatype="hidden" default_value="0"/>
  <UserPref name="StockTickers" datatype="hidden" default_value=""/>
  <UserPref name="StockQtys" datatype="hidden" default_value=""/>
  <UserPref name="StockPrices" datatype="hidden" default_value=""/>
  <UserPref name="StockTC" datatype="hidden" default_value=""/>
  <UserPref name="StockHi" datatype="hidden" default_value=""/>
  <UserPref name="StockLo" datatype="hidden" default_value=""/>
  <UserPref name="Column0" display_name="__MSG_column__ 0" datatype="hidden" default_value="1"/>
  <UserPref name="Column1" display_name="__MSG_column__ 1" datatype="enum" default_value="6"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_numberofstocks__"/><EnumValue value="3" display_value="__MSG_buyprice__"/><EnumValue value="4" display_value="__MSG_hialert__"/><EnumValue value="5" display_value="__MSG_loalert__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_change__"/><EnumValue value="8" display_value="__MSG_changepercent__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_dayhigh__"/><EnumValue value="11" display_value="__MSG_daylow__"/><EnumValue value="12" display_value="__MSG_dayrange__"/><EnumValue value="13" display_value="__MSG_exchange__"/><EnumValue value="14" display_value="__MSG_dayvolume__"/><EnumValue value="15" display_value="__MSG_lasttradetime__"/></UserPref>
  <UserPref name="Column2" display_name="__MSG_column__ 2" datatype="enum" default_value="8"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_numberofstocks__"/><EnumValue value="3" display_value="__MSG_buyprice__"/><EnumValue value="4" display_value="__MSG_hialert__"/><EnumValue value="5" display_value="__MSG_loalert__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_change__"/><EnumValue value="8" display_value="__MSG_changepercent__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_dayhigh__"/><EnumValue value="11" display_value="__MSG_daylow__"/><EnumValue value="12" display_value="__MSG_dayrange__"/><EnumValue value="13" display_value="__MSG_exchange__"/><EnumValue value="14" display_value="__MSG_dayvolume__"/><EnumValue value="15" display_value="__MSG_lasttradetime__"/></UserPref>
  <UserPref name="Column3" display_name="__MSG_column__ 3" datatype="enum" default_value="12"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_numberofstocks__"/><EnumValue value="3" display_value="__MSG_buyprice__"/><EnumValue value="4" display_value="__MSG_hialert__"/><EnumValue value="5" display_value="__MSG_loalert__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_change__"/><EnumValue value="8" display_value="__MSG_changepercent__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_dayhigh__"/><EnumValue value="11" display_value="__MSG_daylow__"/><EnumValue value="12" display_value="__MSG_dayrange__"/><EnumValue value="13" display_value="__MSG_exchange__"/><EnumValue value="14" display_value="__MSG_dayvolume__"/><EnumValue value="15" display_value="__MSG_lasttradetime__"/></UserPref>
  <UserPref name="Column4" display_name="__MSG_column__ 4" datatype="enum" default_value="0"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_numberofstocks__"/><EnumValue value="3" display_value="__MSG_buyprice__"/><EnumValue value="4" display_value="__MSG_hialert__"/><EnumValue value="5" display_value="__MSG_loalert__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_change__"/><EnumValue value="8" display_value="__MSG_changepercent__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_dayhigh__"/><EnumValue value="11" display_value="__MSG_daylow__"/><EnumValue value="12" display_value="__MSG_dayrange__"/><EnumValue value="13" display_value="__MSG_exchange__"/><EnumValue value="14" display_value="__MSG_dayvolume__"/><EnumValue value="15" display_value="__MSG_lasttradetime__"/></UserPref>
  <UserPref name="Column5" display_name="__MSG_column__ 5" datatype="enum" default_value="0"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_numberofstocks__"/><EnumValue value="3" display_value="__MSG_buyprice__"/><EnumValue value="4" display_value="__MSG_hialert__"/><EnumValue value="5" display_value="__MSG_loalert__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_change__"/><EnumValue value="8" display_value="__MSG_changepercent__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_dayhigh__"/><EnumValue value="11" display_value="__MSG_daylow__"/><EnumValue value="12" display_value="__MSG_dayrange__"/><EnumValue value="13" display_value="__MSG_exchange__"/><EnumValue value="14" display_value="__MSG_dayvolume__"/><EnumValue value="15" display_value="__MSG_lasttradetime__"/></UserPref>
  <UserPref name="Column6" display_name="__MSG_column__ 6" datatype="enum" default_value="0"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_numberofstocks__"/><EnumValue value="3" display_value="__MSG_buyprice__"/><EnumValue value="4" display_value="__MSG_hialert__"/><EnumValue value="5" display_value="__MSG_loalert__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_change__"/><EnumValue value="8" display_value="__MSG_changepercent__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_dayhigh__"/><EnumValue value="11" display_value="__MSG_daylow__"/><EnumValue value="12" display_value="__MSG_dayrange__"/><EnumValue value="13" display_value="__MSG_exchange__"/><EnumValue value="14" display_value="__MSG_dayvolume__"/><EnumValue value="15" display_value="__MSG_lasttradetime__"/></UserPref>
  <UserPref name="FontSize" display_name="__MSG_fontsize__" datatype="enum" default_value="11px"><EnumValue value="9px" display_value="9px"/><EnumValue value="10px" display_value="10px"/><EnumValue value="11px" display_value="11px"/><EnumValue value="12px" display_value="12px"/><EnumValue value="14px" display_value="14px"/></UserPref>


  //http://docs.opensocial.org/display/OSD/App+Data
  //http://24ways.org/2005/dont-be-eval

  <Content type="html" view="home,canvas,preview">
    <![CDATA[

  <style type="text/css">
    .Loading{font-family:sans-serif;foreground:#666666;font-style:italic;font-size:11px;}
    .Footer{font-size:9px;font-family:sans-serif;padding:0px;margin:0px;}
    .HrDef{height:1px;margin-top:1px;margin-bottom:1px;margin-right:0px;margin-left:0px;}
  </style>

  <div id="promo"></div>
  <div id="StockData"><div class="Loading">__MSG_initialloading__</div></div>
  <div id="Footer" class="Footer"></div>

  <div id="disclaimer" nowrap><hr class="HrDef"><table border=0 cellspacing=0 cellpadding=0 width="100%"><tr><td valign="middle" class="Footer" nowrap width="10%"><a href="http://sites.google.com/site/cnybroe/iGoogleStockGadget/disclaimer" target="_blank">Stock data, news and historical charts provided by </a></td><td>&nbsp;<img width="16" height="16" border=0 alt="Google" title="Google" src="http://stockportfoliogg.googlecode.com/svn/Google/released/images/google.png"></td><td id="gVersion" nowrap valign="middle" align="right" width="90%" class="Footer">Version</td></tr></table></div>
  <div id="debug" nowrap style="display:none;font-size:9pt;padding:5px;color:red;width:100%;height:200px;overflow:scroll"></div> 

  <script language="javascript" type="text/javascript" defer="defer">
    var pref=new gadgets.Prefs(__MODULE_ID__);
    var iStockCols=6;
    var IMAGES_BASE="http://stockportfoliogg.googlecode.com/svn/Google/released/images/";
    var fsize=pref.getString("FontSize");
    var iVersion="1.0&alpha;";
    var iPrefVersion=0;
    var debug=1;

    //Search: http://www.google.com/finance/match?matchtype=matchall&q=abb
    //News: http://www.google.com/finance/company_news?q=NASDAQ:GOOG&output=rss
    //Image: http://www.google.com/finance/chart?cht=c&q=goog&p=1m&tlf=24h

   //This defines the Stock object:
    Stock.prototype.value=function(){return this.qty*this.price;};
    function Stock(index,ticker,qty,price,hiLim,loLim) 
    {
      this.index = index;
      this.ticker = ticker;
      this.qty = qty;
      this.price = price;
      this.hiLim = hiLim;
      this.loLim = loLim;
      this.last = 0;
      this.dayhigh = 0;
      this.daylow = 0;
      this.dayrange = this.low + " - " + this.dayhigh;
      this.open = 0;
      this.chg = 0;
      this.chgPct = 0;
      this.volume = 0;
      this.exchange = "";
      this.tradeDateTime = "";
      this.updated = 0;
      if (this.last>this.hi){OnHi(this.index);}
      if (this.last<this.lo){OnLo(this.index);}
    }

    function OnHi(i)
    {
      //msg('Hi limit passed on index: '+i);
    }
    
    function OnLo(i)
    {
      //msg('Lo limit passed on index: '+i);
    }
    
    //Create stocks collection
    Array.prototype.Add=function(ticker,qty,price,hi,lo){this[index++] = new Stock(index,ticker,qty,price,hi,lo);};
    Array.prototype.GetTickers=function(){var n = [];for(var i=0;i<this.length;i++){n[i]=Stocks[i].ticker;}return n;};
    Array.prototype.GetStockByTickerName=function(name){for(var i=0;i<this.length;i++){if(Stocks[i].ticker==name && Stocks[i].updated==0){return Stocks[i];}}};
    Array.prototype.UpdateStocks=function(){for(var i=0;i<this.length;i++){Stocks[i].updated=0;}fnReqStockData();};
    var Stocks = [];
    var index = 0;

    function fnInit()
    {
        document.getElementById("gVersion").innerHTML='Version:'+iVersion;
        fnReadPrefs();
        fnLoad();
        //setTimeout('fnMessage();_IG_Analytics("UA-2031644-1", "/Portfolio")',2000);
    }
     
    function fnReqStockData()
    {
        var quote = new google.finance.Quote();
        quote.getQuotes(Stocks.GetTickers());
        quote.addListener(fnRecvStockData);	  
    }

    function fnRecvStockData(data)
    {
        //Check that tickers always are retured in same order as reuested
        //print(Stocks.GetStockByTickerName(data[google.finance.TICKER]).ticker);

        var a = Stocks.GetStockByTickerName(data[google.finance.TICKER]);
        if (a)
        {
            a.last = data[google.finance.LAST];
            a.chg = data[google.finance.CHANGE];
            a.chgPct = data[google.finance.CHANGE_PCT];
            a.open = data[google.finance.OPEN];
            a.dayhigh = data[google.finance.HIGH];
            a.daylow = data[google.finance.LOW];
            a.exchange = data[google.finance.EXCHANGE];
            a.volume = data[google.finance.VOLUME];
            a.tradeDateTime = data[google.finance.LAST_TRADE_DATETIME];    
            a.updated = 1;   
            print(a.ticker + ": " + a.last);
        } 
        else
        {
            print(data[google.finance.TICKER] + " not found in stocks object !!!");
        }
        var b = "last";
        print(Stocks[0].Items[0]);
    }


    function fnSavePrefs()
    {
//        var arrStock = ['0,100,20,80','1,101,21,81','2,102,22,82'];
//        var arrStocks= [arrStock[0],arrStock[1],arrStock[2]];

//        for(i=0;iprefLen;i++)

//        pref.set("Stocks",);
    }

    function fnReadPrefs(){
        var arrStocks = [];
        //var prefStr = pref.getString("Stocks");
        var prefStr = "GOOG,0,100,20,80;MFST,1,101,21,81;FCX,2,102,22,82;GOOG,1,101,21,81";
        
        var arrStocks = prefStr.split(";");
        var prefLen = arrStocks.length;
        for(var i=0;i<prefLen;i++)
        {
            arrStocks[i]=arrStocks[i].split(",");
            Stocks.Add(arrStocks[i][0],arrStocks[i][1],arrStocks[i][2],arrStocks[i][3],arrStocks[i][4]);
        }
   
    iPrefVersion=pref.getString("GadgetVersion");
  }

    function fnLoad(){
        //Maketables
        fnInsertFooterTB();
        fnInsertStockTable();
        
        //fnPrefsValidation(arrStockSymbols);
        Stocks.UpdateStocks();
    }

    function fnInsertStockTable(){
        var sBGColor;
        var sStockTable='<table border=2 cellspacing=0 width="100%" style="font-size:'+fsize+';" class="def">';

        var arrHeaderNames=',__MSG_symbol__,__MSG_numberofstocks__,__MSG_buyprice__,__MSG_hialert__,__MSG_loalert__,__MSG_lasttrade__,__MSG_change__,__MSG_changepercent__,__MSG_dayopen__,__MSG_dayhigh__,__MSG_daylow__,__MSG_dayrange__,__MSG_exchange__,__MSG_dayvolume__,__MSG_lasttradetime__'.split(",");
        var sHead="";
        iConfCols=0;
        for(i=1;i<iStockCols;i++)
        {
            if(pref.getString("Column"+i)!='0')
            {
                iConfCols++;
                sHead+='<td class="cellR">'+arrHeaderNames[pref.getString("Column"+i)]+'</td>';
            }
        }
        sStockTable+='<COLGROUP width="8px"><COLGROUP width="10%"><COLGROUP span="'+iConfCols+'" width="'+90/iConfCols+'%"><tr style="font-weight: bold;"><td style="padding-right:8px" title="Alerts"><div class="Chart" id="StockChart"></div></td><td class="cellL">__MSG_symbol__</td>';
            
        sStockTable+=sHead;
        sStockTable+='</tr><tr style="height:1px;background-Color:BCBCBC"><td colspan='+Number(iConfCols+2)+'></td></tr>';
        for(i=0;i<Stocks.length;i++){
            if(i%2==0){sBGColor='#FFFFFF';}else{sBGColor='#EFEFEF';}
            sStockTable+='<tr id="str'+i+'" style="background-Color:'+sBGColor+';"><td class="cellL" id="stc'+i+'0"></td><td class="cellL" id="stc'+i+'1">'+Stocks[i].ticker+'</td>';
            for(j=2;j<iConfCols+2;j++)
            {
                sStockTable+='<td class="cellR" id="stc'+i+j+'"></td>';
            }
            sStockTable+='</tr>';
        }
        sStockTable+='</table>';

        //alert(sStockTable);

        document.getElementById("StockData").innerHTML=sStockTable;
    }

    function fnInsertFooterTB()
    {
        document.getElementById("Footer").innerHTML='<table border="0" cellspacing="0" celpadding="1px" width="100%"><tr><td colspan="7" style="height:2px"></td></tr><tr class="Footer"><td id="FooterMsg" nowrap>__MSG_stockloading__</td><td width="18px"><img id="AddEditIcon" width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" onclick="fnToggleAdd(0)" src="'+IMAGES_BASE+'AddEdit.gif" title="__MSG_showaddedit__"></td><td style="width:18px;"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer" onclick="fnToggleSummary(1)" src="'+IMAGES_BASE+'Summary.gif" title="__MSG_showsummary__"></td><td style="width:18px;"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" onclick="fnToggleProfit(false)" src="'+IMAGES_BASE+'money.gif" title="__MSG_showprofit__"></td><td style="width:18px;"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" onclick="fnToggleNews(1);" src="'+IMAGES_BASE+'News.gif" title="__MSG_shownews__"/></td><td style="width:18px;"><a href="http://sites.google.com/site/cnybroe/iGoogleStockGadget/help-1" target="_blank"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" src="'+IMAGES_BASE+'help.gif" title="__MSG_help__"></a></td><td style="width:18px;"><a href="http://ggforum.cnybroe.dk/default.aspx?g=forum&c=2" target="_blank"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" src="'+IMAGES_BASE+'ggroups.gif" title="__MSG_gotoggroups__"></a></td></tr></table>';
    }

  function fnZeroPad(num,length)
  {
    var snum = num + '';
    while(snum.length < length)
    {
      snum = '0' + snum; 
    }
    return snum;
  }

  function trim(s)
  {
    if (s)
    {
      return s.replace(/^\s*/,"").replace(/\s*$/,"");
    }
    else
    {
      return "";
    }
  }

  function fngetDate(secs)
  {
    var currentTime=new Date();
    var month=fnZeroPad(currentTime.getMonth()+1,2);
    var day=fnZeroPad(currentTime.getDate(),2);
    var year=currentTime.getFullYear();
    var hours=fnZeroPad(currentTime.getHours(),2);
    var minutes=fnZeroPad(currentTime.getMinutes(),2);
    if(secs){minutes+=':'+fnZeroPad(currentTime.getSeconds(),2);}
    return year+'-'+month+'-'+day+' '+hours+':'+minutes;
  }

  function print(msg)
  {
    if (debug==1)
    {
      var debug_html = document.getElementById("debug").innerHTML;
      if (document.getElementById("debug").style.display=='none')
      {
        document.getElementById("debug").style.display='block';
        gadgets.window.adjustHeight();   
      }
      msg=fngetDate(1)+"; "+msg.toString()+"<br>";
      debug_html=msg+debug_html;
      document.getElementById("debug").innerHTML=debug_html;
    }
  }



    //1-2-3 start
    fnInit();  

    </script>
    ]]>
    </Content>
  </Module>