<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="__MSG_gadgettitle__" description="__MSG_gadgetdesc__" directory_title="Stock portfolio" scrolling="false" singleton="false" scaling="true" height="200" thumbnail="http://cnybroe.googlepages.com/StockPortfolioThumb.png" screenshot="http://cnybroe.googlepages.com/StockPortfolio.png" author="Christian Nybroe" author_email="cnybroe.feedback+Stockgadget@gmail.com" author_affiliation="Personal" author_location="Taasinge, Denmark" author_link="http://cnybroe.googlepages.com/" category="finance">
    <Require feature="setprefs"/><Require feature="minimessage"/><Require feature="analytics"/><Require feature="dynamic-height"/><Require feature="settitle"/>
    <Locale messages="http://cnybroe.googlepages.com/ALL_ALL.xml"/> 
    <Locale lang="da" messages="http://cnybroe.googlepages.com/da_ALL.xml"/> 
    <Locale lang="es" messages="http://cnybroe.googlepages.com/es_ALL.xml"/> 
    <Locale lang="fr" messages="http://cnybroe.googlepages.com/fr_ALL.xml"/> 
    <Locale lang="it" messages="http://cnybroe.googlepages.com/it_ALL.xml"/> 
    <Locale lang="sv" messages="http://cnybroe.googlepages.com/sv_ALL.xml"/> 
    <Locale lang="pt-PT" messages="http://cnybroe.googlepages.com/pt_PT.xml"/> 
    <Locale lang="pt-BR" messages="http://cnybroe.googlepages.com/pt_BR.xml"/> 
    <Locale lang="de" messages="http://cnybroe.googlepages.com/de_ALL.xml"/> 
    <Locale lang="nl" messages="http://cnybroe.googlepages.com/nl_ALL.xml"/> 
    <Locale lang="zh-TW" messages="http://cnybroe.googlepages.com/zh_TW.xml"/> 
  </ModulePrefs>
  <UserPref name="GadgetVersion" datatype="hidden" default_value=""/>
  <UserPref name="StockSymbols" datatype="hidden" default_value="GOOG"/>
  <UserPref name="StockQtys" datatype="hidden" default_value="0"/>
  <UserPref name="StockHi" datatype="hidden" default_value="0"/>
  <UserPref name="StockLo" datatype="hidden" default_value="0"/>
  <UserPref name="StockPrices" datatype="hidden" default_value="0"/>
  <UserPref name="CustomTitle" display_name="__MSG_customtitle__"  default_value="__MSG_gadgettitle__"/>
  <UserPref name="FontSize" display_name="__MSG_fontsize__" datatype="enum" default_value="12px"><EnumValue value="9px" display_value="9px"/><EnumValue value="10px" display_value="10px"/><EnumValue value="11px" display_value="11px"/><EnumValue value="12px" display_value="12px"/><EnumValue value="14px" display_value="14px"/><EnumValue value="16px" display_value="16px"/></UserPref>
  <UserPref name="NameColumn" display_name="__MSG_name__ __MSG_column__" datatype="enum" default_value="2"><EnumValue value="1" display_value="__MSG_symbol__"/><EnumValue value="2" display_value="__MSG_name__"/></UserPref>
  <UserPref name="ChangeColumn" display_name="__MSG_change__ __MSG_column__" datatype="enum" default_value="3"><EnumValue value="3" display_value="__MSG_changepercent__"/><EnumValue value="4" display_value="__MSG_change__"/><EnumValue value="5" display_value="__MSG_change__(%)"/></UserPref>
  <UserPref name="Column1" display_name="__MSG_column__ 1" datatype="enum" default_value="6"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="3" display_value="__MSG_changepercent__"/><EnumValue value="4" display_value="__MSG_change__"/><EnumValue value="5" display_value="__MSG_change__(%)"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_lasttradedate__"/><EnumValue value="8" display_value="__MSG_lasttradetime__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_daylow__"/><EnumValue value="11" display_value="__MSG_dayhigh__"/><EnumValue value="12" display_value="__MSG_dayvolume__"/><EnumValue value="13" display_value="__MSG_previousclose__"/><EnumValue value="14" display_value="__MSG_52weekrange__"/><EnumValue value="15" display_value="__MSG_ask__"/><EnumValue value="16" display_value="__MSG_bid__"/><EnumValue value="17" display_value="__MSG_tickertrend__"/><EnumValue value="18" display_value="__MSG_50daymovingavg__"/><EnumValue value="19" display_value="__MSG_200daymovingavg__"/><EnumValue value="20" display_value="__MSG_dayrange__"/><EnumValue value="25" display_value="__MSG_dayearned__"/><EnumValue value="26" display_value="__MSG_earned__"/></UserPref>
  <UserPref name="Column2" display_name="__MSG_column__ 2" datatype="enum" default_value="26"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_lasttradedate__"/><EnumValue value="8" display_value="__MSG_lasttradetime__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_daylow__"/><EnumValue value="11" display_value="__MSG_dayhigh__"/><EnumValue value="12" display_value="__MSG_dayvolume__"/><EnumValue value="13" display_value="__MSG_previousclose__"/><EnumValue value="14" display_value="__MSG_52weekrange__"/><EnumValue value="15" display_value="__MSG_ask__"/><EnumValue value="16" display_value="__MSG_bid__"/><EnumValue value="17" display_value="__MSG_tickertrend__"/><EnumValue value="18" display_value="__MSG_50daymovingavg__"/><EnumValue value="19" display_value="__MSG_200daymovingavg__"/><EnumValue value="20" display_value="__MSG_dayrange__"/><EnumValue value="25" display_value="__MSG_dayearned__"/><EnumValue value="26" display_value="__MSG_earned__"/></UserPref>
  <UserPref name="Column3" display_name="__MSG_column__ 3" datatype="enum" default_value="17"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_lasttradedate__"/><EnumValue value="8" display_value="__MSG_lasttradetime__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_daylow__"/><EnumValue value="11" display_value="__MSG_dayhigh__"/><EnumValue value="12" display_value="__MSG_dayvolume__"/><EnumValue value="13" display_value="__MSG_previousclose__"/><EnumValue value="14" display_value="__MSG_52weekrange__"/><EnumValue value="15" display_value="__MSG_ask__"/><EnumValue value="16" display_value="__MSG_bid__"/><EnumValue value="17" display_value="__MSG_tickertrend__"/><EnumValue value="18" display_value="__MSG_50daymovingavg__"/><EnumValue value="19" display_value="__MSG_200daymovingavg__"/><EnumValue value="20" display_value="__MSG_dayrange__"/><EnumValue value="25" display_value="__MSG_dayearned__"/><EnumValue value="26" display_value="__MSG_earned__"/></UserPref>
  <UserPref name="Column4" display_name="__MSG_column__ 4" datatype="enum" default_value="0"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_lasttradedate__"/><EnumValue value="8" display_value="__MSG_lasttradetime__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_daylow__"/><EnumValue value="11" display_value="__MSG_dayhigh__"/><EnumValue value="12" display_value="__MSG_dayvolume__"/><EnumValue value="13" display_value="__MSG_previousclose__"/><EnumValue value="14" display_value="__MSG_52weekrange__"/><EnumValue value="15" display_value="__MSG_ask__"/><EnumValue value="16" display_value="__MSG_bid__"/><EnumValue value="17" display_value="__MSG_tickertrend__"/><EnumValue value="18" display_value="__MSG_50daymovingavg__"/><EnumValue value="19" display_value="__MSG_200daymovingavg__"/><EnumValue value="20" display_value="__MSG_dayrange__"/><EnumValue value="25" display_value="__MSG_dayearned__"/><EnumValue value="26" display_value="__MSG_earned__"/></UserPref>
  <UserPref name="Column5" display_name="__MSG_column__ 5" datatype="enum" default_value="0"><EnumValue value="0" display_value="__MSG_notused__"/><EnumValue value="6" display_value="__MSG_lasttrade__"/><EnumValue value="7" display_value="__MSG_lasttradedate__"/><EnumValue value="8" display_value="__MSG_lasttradetime__"/><EnumValue value="9" display_value="__MSG_dayopen__"/><EnumValue value="10" display_value="__MSG_daylow__"/><EnumValue value="11" display_value="__MSG_dayhigh__"/><EnumValue value="12" display_value="__MSG_dayvolume__"/><EnumValue value="13" display_value="__MSG_previousclose__"/><EnumValue value="14" display_value="__MSG_52weekrange__"/><EnumValue value="15" display_value="__MSG_ask__"/><EnumValue value="16" display_value="__MSG_bid__"/><EnumValue value="17" display_value="__MSG_tickertrend__"/><EnumValue value="18" display_value="__MSG_50daymovingavg__"/><EnumValue value="19" display_value="__MSG_200daymovingavg__"/><EnumValue value="20" display_value="__MSG_dayrange__"/><EnumValue value="25" display_value="__MSG_dayearned__"/><EnumValue value="26" display_value="__MSG_earned__"/></UserPref>
  <UserPref name="ShowProfit" display_name="__MSG_showprofit__" datatype="enum" default_value="NotUsed"><EnumValue value="NotUsed" display_value="__MSG_notused__"/><EnumValue value="Summary" display_value="__MSG_profitsummary__"/><EnumValue value="Details" display_value="__MSG_profitdetails__"/></UserPref>
  <UserPref name="ChartType" display_name="__MSG_showsummary__" datatype="enum" default_value="ToolTip"><EnumValue value="NotUsed" display_value="__MSG_notused__"/><EnumValue value="ToolTip" display_value="__MSG_charttooltip__"/><EnumValue value="Summary" display_value="__MSG_chartsummary__"/></UserPref>
  <UserPref name="ChartScope" display_name="__MSG_chartperiod__" datatype="enum" default_value="3m"><EnumValue value="1d" display_value="1 __MSG_day__"/><EnumValue value="5d" display_value="5 __MSG_days__"/><EnumValue value="1m" display_value="1 __MSG_month__"/><EnumValue value="3m" display_value="3 __MSG_months__"/><EnumValue value="1y" display_value="6 __MSG_months__"/></UserPref>
  <UserPref name="UpdateInterval" display_name="__MSG_updateinterval__" datatype="enum" default_value="300000"><EnumValue value="10000" display_value="10 __MSG_second__"/><EnumValue value="60000" display_value="1 __MSG_minute__"/><EnumValue value="300000" display_value="5 __MSG_minute__"/><EnumValue value="600000" display_value="10 __MSG_minute__"/><EnumValue value="3600000" display_value="60 __MSG_minute__"/></UserPref>
  <UserPref name="Flashing" display_name="__MSG_flashing__" default_value="true" datatype="bool"/>
<Content type="html">
  <![CDATA[
  <style type="text/css">
    .def{font-family:sans-serif;}
    .loading{font-family:sans-serif;foreground:#666666;font-style:italic;font-size:11px;}
    .Footer{font-size:9px;font-family:courier new;padding:0px;margin:0px;}
    .Chart{display:none;filter:alpha(opacity=85);opacity:0.85;background-color:#FFFFFF;width:192;height:96;position:absolute;color:white;border:2px solid black;z-index:9999;}
    .SearchList{display:none;position:relative;border:1px solid black;z-index:9998;background-color:white;top:-1;}
    .HrDef{height:2px;margin-top:3px;margin-bottom:3px;margin-right:0px;margin-left:0px;}
    td.HiAlert{width:9px;background:url("http://cnybroe.googlepages.com/HiAlert9.gif");background-repeat:no-repeat;background-position:center;}
    td.LoAlert{width:9px;background:url("http://cnybroe.googlepages.com/LoAlert9.gif");background-repeat:no-repeat;background-position:center;}
  </style>
  <div id="StockData"><div class="loading">__MSG_initialloading__</div></div>
  <div id="Footer"></div>
  <div id="StockAdd" style="display:none;"></div>
  <div id="StockProfitSummary" style="display:none"></div>
  <div id="StockProfitDetails" style="display:none;"><div class="loading">__MSG_loading__</div></div>
  <div id="StockSummary" style="display:none;"><div class="loading">__MSG_loading__</div></div>
  <div id="StockNews" style="display:none;"></div>
  <div id="debug" nowrap style="display:none;font-size:9pt;padding:5px;color:red;width:100%;height:200px;overflow:scroll"></div> 
  <script>
    _IG_Analytics("UA-2031644-1", "/Portfolio");
  </script>
  <script language="javascript" type="text/javascript" defer="defer">
  var pref=new _IG_Prefs(__MODULE_ID__);
  var fsize=pref.getString("FontSize");
  var cColumns=5;
  var iConfiguredColumns=0;
  var arrStockSymbols="";
  var arrStockQtys="";
  var arrStockHi="";
  var arrStockLo="";
  var arrStockPrices="";
  var arrStocks=new Array();
  var miniMsg=new _IG_MiniMessage(__MODULE_ID__);
  var sVersion="1.170";
  var sSymbols='';
  var bPageLoaded=false;
  var bDataReceived=false;
  var debug=1;
  _IG_RegisterOnloadHandler(fnOnInit());

  function fnOnInit(){
    if(pref.getString("GadgetVersion")!=sVersion){
	    var msghtml='<a target=\"_new\" href=\"http://cnybroe.googlepages.com/\">2008-01-16: Added High/low alerts. Improved stock search. Started writing a help page.<a>';
	    miniMsg.createDismissibleMessage(msghtml, fnHideMess(sVersion));
    }
    fnInsertSummary();
    fnInsertFooter();
    if(pref.getString("ShowProfit")=='Summary'){
      _gel("StockProfitSummary").style.display='block';
    }else if(pref.getString("ShowProfit")=='Details'){
      _gel("StockProfitDetails").style.display='block';
    }
    for(i=1;i<cColumns+1;i++){
      if(pref.getString("Column"+i)!='0'){
        iConfiguredColumns++;
      }
     }
    fnOnLoad();
  }
  function fnOnLoad(){
    fnReadPrefs();
    fnInsertStockTable();
    fnInsertProfitDetailsTable();
    fnInsertProfitSummaryTable();
    fnUpdateStocks();
  }
  function fnPostLoad(){
    //print("fnPostLoad called");
    if(bPageLoaded==false){
      if(pref.getString("ChartType")=="Summary"&&_gel("StockSummary").style.display=="none"&&bPageLoaded==false){
        fnToggleSummary();
      }
      if(pref.getInt("ShowProfit")==1&&_gel("StockProfitDetails").style.display=="none"&&bPageLoaded==false){
        fnToggleProfit();
      }
      fnUpdateSummary(0);
      //print("Awaiting timeouts....");
      setTimeout('_IG_SetTitle(pref.getString("CustomTitle"));_IG_AdjustIFrameHeight();',500);
      setTimeout('_IG_AdjustIFrameHeight();',2000);
      bPageLoaded=true;
    }
  }
  function fnUpdateStocks(){
    var sTags='&f=e1snp2c1cl1d1t1oghvpwabt7m8m6m';
    sSymbols="";
    if(arrStockSymbols.length>0){
      for(var i=0;i<arrStockSymbols.length;i++){
        sSymbols+=arrStockSymbols[i]+'+';
      }
      if(sSymbols.length>1){
        url='http://finance.yahoo.com/d/quotes.csv?s='+sSymbols+sTags;
        _IG_FetchContent(url,fnParseStockData,{refreshInterval:(60*1)});
      }
    }
    setTimeout('fnRetry()',4000);
    setTimeout('fnUpdateStocks()',pref.getInt("UpdateInterval"));
  }
  
  function fnRetry(){
    if (bPageLoaded==false){
      if (arrStockSymbols.length>0){
        print('Data appearently not received. Retrying stockdata request...');
        _gel('stc01').innerHTML='<div class="loading">__MSG_retrystockloading__</div>';
        fnUpdateStocks();
      }
    }
  }
  
  function fnParseStockData(str){
    var arrLines=new Array();
    var arrLineValues=new Array();
    var sTemp="";
    var sName="";
    var sColor="";
    var sbgColor="";
    var iDayTotal=0;
    var iEarnTot=0;
    var iValTot=0;
    //print(str);
    arrLines=str.split('\n');
    if (arrLines.length>1){
      for(i=0;i<arrLines.length-1;i++){
        var sClass="";
        arrLineValues=splitLine(arrLines[i]);
        arrLineValues[25]=(isNaN(arrLineValues[4]))?0:Math.round(arrLineValues[4]*arrStockQtys[i]*10)/10;
        iDayTotal+=arrLineValues[25];arrLineValues[27]=(isNaN(arrLineValues[3]))?0:arrLineValues[3];
        if(arrStockQtys[i]>0&&arrStockPrices[i]>0){
          arrLineValues[26]=Math.round((arrLineValues[6]-arrStockPrices[i])*parseInt(arrStockQtys[i],10)*10)/10;
          iEarnTot+=arrLineValues[26];
          arrLineValues[28]=Math.round(((arrLineValues[6]-arrStockPrices[i])/arrStockPrices[i])*1000)/10;
        }else{
          arrLineValues[26]=0;
          arrLineValues[28]=0;
        }
        if(arrStockQtys[i]>0){
          arrLineValues[29]=Math.round(arrLineValues[6]*arrStockQtys[i]);
          iValTot+=arrLineValues[29];
        }else{
          arrLineValues[29]=0;
        }
        arrStocks[i]=arrLineValues;
        sTemp=arrLineValues[2];
        sName=arrLineValues[pref.getInt("NameColumn")];
        if (pref.getInt("NameColumn")==2 && sName==''){
          sName=arrLineValues[1];
          sTemp=sName;
        }
        _gel('stc'+i+'1').innerHTML='<b><a Title="'+sTemp+'" id="stcn'+i+'" onmouseover="fnShowTPChart('+i+');fnUpdateSummary('+i+');" onmouseout="fnHideTPChart(this)" target="_new" href="http://finance.yahoo.com/q?s='+arrLineValues[1]+'">'+sName+'</a></b>';
        sTemp=arrLineValues[pref.getString("ChangeColumn")];
        //if (pref.getString("ChangeColumn")==5){
        //  sTemp=sTemp.replace(' - ','(')+')';
        //  sTemp+=')';
        //}
        
        if(i%2==0){sbgColor='#FFFFFF';}else{sbgColor='#EFEFEF';}
        if(pref.getInt("Flashing")==1&&_gel('stc'+i+'2').innerHTML!=''){
          sColor=sbgColor;_gel('stc'+i+'2').style.background=fnNumToColor(parseFloat(arrLineValues[3])-parseFloat(_gel('stcc'+i+'2').innerHTML),sbgColor);
          setTimeout('_gel("stc'+i+'2").style.background="'+sbgColor+'"',1000);
        }
        if (arrLineValues[6]>arrStockHi[i] && arrStockHi[i]>0){
          sClass="HiAlert";
        }else if(arrLineValues[6]<arrStockLo[i] && arrStockLo[i]>0){
          sClass="LoAlert";
        }
        _gel('stc'+i+'0').className=sClass;
        _gel('stc'+i+'2').innerHTML='<a target="_new" href='+'http://finance.yahoo.com/charts#chart1:symbol='+arrStockSymbols[i]+';range=3m;indicator=volume;charttype=line;crosshair=on;logscale=on;source=><b><font id="stcc'+i+'2" color="'+fnNumToColor(arrLineValues[3],"#000000")+'">'+sTemp+'</font></b></a>';
        var k=3;
        for(j=1;j<cColumns+1;j++){
          if(pref.getString("Column"+j)!='0'){
            _gel('stc'+i+k).innerHTML='<div id="stcc'+i+k+'">'+arrLineValues[pref.getString("Column"+j)]+'</div>';
            k++;
          }
        }
        _gel("ptc0"+i).innerHTML=arrLineValues[2];
        _gel("ptc1"+i).innerHTML=arrLineValues[25]+' ('+arrLineValues[27]+')';
        _gel("ptc2"+i).innerHTML=arrLineValues[26]+' ('+arrLineValues[28]+'%)';
        _gel("ptc3"+i).innerHTML=arrLineValues[29];
        _gel("ptc1"+i).style.color=fnNumToColor(arrLineValues[25],"#000000");
        _gel("ptc2"+i).style.color=fnNumToColor(arrLineValues[26],"#000000");
      }
      iDayTotal=Math.round(iDayTotal*100)/100;
      sColor=fnNumToColor(iDayTotal,"#000000");
      _gel("stct1").style.color=sColor;
      _gel("ptc1"+i).style.color=sColor;
      _gel("stct1").innerHTML='<b>'+iDayTotal+'</b>';
      _gel("ptc1"+i).innerHTML='<b>'+iDayTotal+'</b>';
      iEarnTot=Math.round(iEarnTot*100)/100;
      iValTot=Math.round(iValTot*100)/100;
      sColor=fnNumToColor(iEarnTot,"#000000");
      _gel("stct2").style.color=sColor;
      _gel("ptc2"+i).style.color=sColor;
      _gel("stct2").innerHTML='<b>'+iEarnTot+'</b>';
      _gel("ptc2"+i).innerHTML='<b>'+iEarnTot+'</b>';
      _gel("ptc3"+i).innerHTML='<b>'+iValTot+'</b>';
      _gel("stct3").innerHTML='<b>'+iValTot+'</b>';
      _gel("ptc0"+i).innerHTML='<b>__MSG_total__</b>';
      fnUpdateFooterTS();
      fnPostLoad();
    }
  }
  function fnInsertFooter(){
    _gel("Footer").innerHTML='<table border="0" cellspacing="0" width="100%"><tr><td colspan="6" style="height:2px"></td></tr><tr class="Footer"><td id="FooterTS"></td><td align="right"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" onclick="fnToggleAdd(0)" src="'+_IG_GetImage('http://cnybroe.googlepages.com/AddEdit.gif').src+'" title="__MSG_showaddedit__"></td><td style="width:20px;text-align:right"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer" onclick="fnToggleSummary()" src="'+_IG_GetImage('http://cnybroe.googlepages.com/Summary.gif').src+'" title="__MSG_showsummary__"></td><td style="width:20px;text-align:right"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" onclick="fnToggleProfit()" src="'+_IG_GetImage('http://cnybroe.googlepages.com/money.gif').src+'" title="__MSG_profitsummary__"></td><td style="width:20px;text-align:right"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" onclick="fnToggleNews()" src="'+_IG_GetImage('http://cnybroe.googlepages.com/News.gif').src+'" title="__MSG_shownews__"></td><td style="width:20px;text-align:right"><a href="http://cnybroe.googlepages.com/help" target="_blank"><img width="16" height="16" style="border:none;cursor:hand;cursor:pointer;" src="'+_IG_GetImage('http://cnybroe.googlepages.com/help.gif').src+'" title="__MSG_help__"></a></td></tr></table>';
  }
  function fnNumToColor(number,zeroColor){
    var sColor=zeroColor;
    if(!isNaN(parseFloat(number))){
      if(parseFloat(number)>0){sColor="#008200";}
      if(parseFloat(number)<0){sColor="#FF2200";}
    }
    return sColor;
  }
  function fnInsertStockTable(){
    var sBGColor;
    var sStockTable='<table border=0 cellspacing=0 width="100%" style="font-size:'+fsize+'" class="def">';
    var arrHeaderNames=',,,%,__MSG_change__,__MSG_change__(%),__MSG_lasttrade__,__MSG_lasttradedate__,__MSG_lasttradetime__,__MSG_dayopen__,__MSG_daylow__,__MSG_daylow__,__MSG_dayvolume__,__MSG_previousclose__,__MSG_52weekrange__,__MSG_ask__,__MSG_bid__,__MSG_tickertrend__,__MSG_50daymovingavg__,__MSG_200daymovingavg__,__MSG_dayrange__,,,,,__MSG_dayearned__,__MSG_earned__'.split(",");
    sStockTable+='<tr style="font-weight: bold;"><td nowrap title="Alerts"></td><td nowrap>Name</td><td nowrap align="right"><div class="Chart" id="StockChart"></div>__MSG_change__</td>';
    var w = 100/(cColumns+2);
    for(i=1;i<cColumns+1;i++){
      if(pref.getString("Column"+i)!='0'){
        sStockTable+='<td nowrap align="right" width="' + w + '%">'+arrHeaderNames[pref.getString("Column"+i)]+'</td>';
      }
    }
    sStockTable+='</tr><tr style="height:1px;background-Color:BCBCBC"><td colspan='+Number(iConfiguredColumns+3)+'></td></tr>';
    for(i=0;i<arrStockSymbols.length;i++){
      if(i%2==0){sBGColor='#FFFFFF';}else{sBGColor='#EFEFEF';}
      sStockTable+='<tr id="str'+i+'" style="background-Color:'+sBGColor+';"><td id="stc'+i+'0"></td><td id="stc'+i+'1" nowrap></td>';
      for(j=2;j<iConfiguredColumns+3;j++){
        sStockTable+='<td id="stc'+i+j+'" align="right" nowrap></td>';
      }
      sStockTable+='</tr>';
    }
    sStockTable+='</table>';
    _gel("StockData").innerHTML=sStockTable;
    _gel("stc01").innerHTML='<div class="def" style="font-size:'+fsize+'">__MSG_stockloading__</div>';
  }
  function fnInsertAdd(){
    var sTemp='<hr class="HrDef"><table border=0 id="tblTickers" cellspacing=0 cellpadding=0 style="font-size:'+fsize+'" class="def"><tr><td width="62px" align="left"><input type="text" autocomplete="on" style="font-size:'+fsize+';width:60px" bclass="def" id="txtStockSymbol" name="txtStockSymbol" alt="Symbol" title="__MSG_symbolsearchtip__"  onKeyUp=fnSymbolSearch(this.value,"S")></td><td width="20px" align="left"><img width="12" height="12" style="cursor:hand;cursor:pointer;" onclick="var Temp=_gel(\'txtStockSymbol\').value;fnAddStock(Temp);" title="__MSG_addstock__" src="'+_IG_GetImage('http://cnybroe.googlepages.com/AddStock.gif').src+'"></td><td>__MSG_searchlimit__</td></tr></table><div id="StockAddList" style="font-size:'+fsize+'" class="SearchList"></div>';
    var sLine='<tr style="height:1px;background-Color:BCBCBC"><td colspan=8></td></tr>';
    var sConfigTable='<table width="100%" border=0 cellspacing=0 cellpadding=0 style="font-size:'+fsize+'" class="def"><tr style="height:3px"><td colspan=6></td></tr>'+sLine+'<tr style="font-weight: bold;"><td nowrap width="20%">__MSG_symbol__</td><td nowrap align="right" width="17%">__MSG_buyprice__</td><td nowrap align="right" width="17%">__MSG_numberofstocks__</td><td nowrap align="right" width="17%">__MSG_hialert__</td><td nowrap align="right" width="17%">__MSG_loalert__</td><td width="12%"colspan=3></td></tr>'+sLine;
    for(i=0;i<arrStockSymbols.length;i++){
      sConfigTable+='<tr><td id="ctc0'+i+'" title="__MSG_edittooltip__" onclick="fnEditStock(this)" onmouseover=this.style.backgroundColor="#dcdcdc" onmouseout=this.style.backgroundColor="#FFFFFF" nowrap>'+arrStockSymbols[i]+'</td><td id="ctc1'+i+'" title="__MSG_edittooltip__" onclick="fnEditStock(this)" onmouseover=this.style.backgroundColor="#dcdcdc" onmouseout=this.style.backgroundColor="#FFFFFF" nowrap align="right">'+arrStockPrices[i]+'</td><td id="ctc2'+i+'" title="__MSG_edittooltip__" onclick="fnEditStock(this)" onmouseover=this.style.backgroundColor="#dcdcdc" onmouseout=this.style.backgroundColor="#FFFFFF" nowrap align="right">'+arrStockQtys[i]+'</td><td id="ctc3'+i+'" title="__MSG_edittooltip__" onclick="fnEditStock(this)" onmouseover=this.style.backgroundColor="#dcdcdc" onmouseout=this.style.backgroundColor="#FFFFFF" nowrap align="right">'+arrStockHi[i]+'</td><td id="ctc4'+i+'" title="__MSG_edittooltip__" onclick="fnEditStock(this)" onmouseover=this.style.backgroundColor="#dcdcdc" onmouseout=this.style.backgroundColor="#FFFFFF" nowrap align="right">'+arrStockLo[i]+'</td><td nowrap align="right" width="25px"><img id="ctc5'+i+'" width="10" height="10" style="cursor:hand;cursor:pointer;" onclick="fnDeleteStock('+i+')" src="'+_IG_GetImage('http://cnybroe.googlepages.com/delete.gif').src+'" title="__MSG_deletestock__"></td><td nowrap align="right" width="15px"><img id="ctc6'+i+'" width="10" height="10" style="cursor:hand;cursor:pointer;" onclick="fnMoveStock('+i+',0)" src="'+_IG_GetImage('http://cnybroe.googlepages.com/MoveUp.gif').src+'" title="__MSG_moveup__"></td><td nowrap align="right" width="15px"><img id="ctc7'+i+'" width="10" height="10" style="cursor:hand;cursor:pointer;" onclick="fnMoveStock('+i+',1)" src="'+_IG_GetImage('http://cnybroe.googlepages.com/MoveDown.gif').src+'" title="__MSG_movedown__"></td></tr>';
    }
    sConfigTable+='</table>';
    _gel("StockAdd").innerHTML=sTemp+sConfigTable;
  }
  function fnSymbolSearch(symbol){
    if(trim(symbol)!=''){
      _gel("StockAddList").innerHTML='__MSG_loading__';
      _IG_FetchContent('http://d.yimg.com/autoc.finance.yahoo.com/autoc?query='+symbol+'&callback=YAHOO.Finance.SymbolSuggest.ssCallback',fnSymbolSearchResponse,{refreshInterval:(60*5)});
    }else{
      _gel("StockAddList").style.display="none";
    }
    _IG_AdjustIFrameHeight();
  }
  function fnSymbolSearchResponse(ResponseText){
    var iStart=0;
    var iEnd=0;
    var arrSearch="";
    var i=0;
    var sTemp="";
    var sLine='<tr style="height:1px;background-Color:BCBCBC"><td colspan=4></td></tr>';
    var sTable='<table width="100%" border=0 cellspacing=0 cellpadding=0 style="font-size:'+fsize+'" class="def">'+sLine+'<tr style="font-weight:bold;"><td>Symbol</td><td>Name</td><td>Type</td><td>Exchange</td></tr>'+sLine;
    if (ResponseText.indexOf('"Result":[]',1)<1){
      iStart=ResponseText.indexOf('[{',1)+2;
      iEnd=ResponseText.indexOf('}]',iStart);
      arrSearch=ResponseText.substring(iStart,iEnd).split("},{");
      for(i=0;i<arrSearch.length;i++){
        iStart=arrSearch[i].indexOf('"symbol":"',0)+10;
        iEnd=arrSearch[i].indexOf('","',iStart);
        sSymbol=arrSearch[i].substring(iStart,iEnd);
        sTable+='<tr style="cursor: pointer;" onmouseover=\'this.style.backgroundColor="#DCDCDC";\' onmouseout=\'this.style.backgroundColor="#FFFFFF";\' onclick=\'_gel("txtStockSymbol").value="'+sSymbol+'"\'><td nowrap>'+sSymbol+'</td>';
        iStart=arrSearch[i].indexOf('"name": "',1)+9;
        iEnd=arrSearch[i].indexOf('","',iStart);
        sTable+='<td nowrap>'+arrSearch[i].substring(iStart,iEnd)+'</td>';
        iStart=arrSearch[i].indexOf('"typeDisp":"',1)+12;
        if (iStart>12){
          iEnd=arrSearch[i].indexOf('"',iStart);
          sTemp=arrSearch[i].substring(iStart,iEnd);
        }else{
          sTemp='Stock';
        }
        sTable+='<td nowrap>'+sTemp+'</td>';
        iStart=arrSearch[i].indexOf('"exchDisp":"',1)+12;
        if (iStart>12){
          iEnd=arrSearch[i].indexOf('"',iStart);
        }else{
          iStart=arrSearch[i].indexOf('"exch": "',1)+8;
          iEnd=arrSearch[i].indexOf('"',iStart);
        }
        sTable+='<td nowrap>'+arrSearch[i].substring(iStart,iEnd)+'</td></tr>';
      }
      sTable+="</table>";
    }else{
      sTable+="<tr><td colspan=4>not found</td></tr></table>";
    }
    _gel("StockAddList").innerHTML=sTable;
    _gel("StockAddList").style.display="block";
    _IG_AdjustIFrameHeight();
  }
  function fnInsertSummary(){
    var sTemp='<hr class="HrDef"><table width="100%" border=0 cellspacing=0 cellpadding=0><tr><td id="SummaryChartTD" style="width:1%;height:98px"></td><td><table style="font-size:'+fsize+'" class="def" width="100%" border=0 cellspacing=0 cellpadding=0><tr><td style="width:5px"></td><td nowrap style="width:1%"><b>__MSG_name__</b></td><td style="width:10px"></td><td id="SummaryNameTD" nowrap></td></tr><tr><td style="width:5px"></td><td nowrap style="width:1%"><b>__MSG_dayrange__</b></td><td style="width:10px"></td><td id="SummaryDayRangeTD" nowrap></td></tr><tr><td style="width:5px"></td><td nowrap style="width:1%"><b>__MSG_52weekrange__</b></td><td style="width:10px"></td><td id="Summary52wkRangeTD" nowrap></td></tr><tr><td style="width:5px"></td><td nowrap style="width:1%"><b>__MSG_200daymovingavg__</b></td><td style="width:10px"></td><td id="Summary200AvgTD" nowrap></td></tr><tr><td style="width:5px"></td><td nowrap style="width:1%"><b>__MSG_dayvolume__</b></td><td style="width:10px"></td><td id="SummaryDayVolumeTD" nowrap></td></tr><tr><td style="width:5px"></td><td nowrap style="width:1%"><b>__MSG_lasttradetime__</b></td><td style="width:10px"></td><td id="SummaryLastTradeTime" nowrap></td></tr></table></td></tr></table>';
    _gel('StockSummary').innerHTML=sTemp;
  }
  function fnInsertProfitDetailsTable(){
    var sLine='<tr style="height:1px;background-Color:BCBCBC"><td colspan=4></td></tr>';
    var sProfitTable='<hr class="HrDef"><table width="100%" border=0 cellspacing=0 cellpadding=0 style="font-size:'+fsize+'" class="def"><tr style="font-weight:bold;text-align:right"><td nowrap align="left">__MSG_name__</td><td nowrap>__MSG_dayearned__</td><td nowrap>__MSG_earned__</td><td nowrap>__MSG_value__</td></tr>'+sLine;
    for(i=0;i<arrStockSymbols.length+1;i++){
      if(i==arrStockSymbols.length){
        sProfitTable+=sLine;
      }
      sProfitTable+='<tr style="text-align:right"><td id="ptc0'+i+'" nowrap align="left" width="28%"></td><td id="ptc1'+i+'" nowrap width="28%"></td><td id="ptc2'+i+'" nowrap width="28%"></td><td id="ptc3'+i+'" nowrap width="16%"></td></tr>';
    }
    sProfitTable+='</table>';
    _gel("StockProfitDetails").innerHTML=sProfitTable;
  }
  function fnEditStock(sender){
    if(sender.innerHTML.toLowerCase().indexOf("input",1)>0){return;}
    var sTemp=sender.innerHTML;
    var b=document.createElement("INPUT");
    b.id="txtTempInput";
    b.style.fontSize=fsize;
    b.style.fontFamily="sans-serif";
    b.style.textAlign=(sender.id.substr(3,1)==0)?'left':'right';
    b.style.width=(sender.id.substr(3,1)==0)?'70px':'40px';
    b.style.height="18px";
    b.style.margin="0px";
    b.onblur=function(){var index=sender.id.substr(4);var col=sender.id.substr(3,1);if((col==0&&trim(b.value)!="")||!isNaN(b.value)){if(col==0){arrStockSymbols[index]=b.value;}else if(col==1){arrStockPrices[index]=b.value;}else if(col==2){arrStockQtys[index]=b.value;}else if(col==3){arrStockHi[index]=b.value;}else if(col==4){arrStockLo[index]=b.value;}fnSavePrefs();fnUpdateStocks();}fnInsertAdd();};
    sender.innerHTML="";
    sender.appendChild(b);
    b.focus();
    b.value=sTemp;
    b.select();
  }
  function fnInsertProfitSummaryTable(){
    var sProfitTable='<hr class="HrDef"><table width="100%" border=0 cellspacing=0 cellpadding=0 style="font-size:'+fsize+'" class="def">';
    sProfitTable+='<tr><td width=100%><td nowrap>__MSG_dayearnedtotal__: </td><td id="stct1" nowrap></td><td width="10px" nowrap></td><td nowrap>__MSG_earnedtotal__: </td><td id="stct2" nowrap></td><td width="10px" nowrap></td><td nowrap>__MSG_valuetotal__: </td><td id="stct3" nowrap></td></tr></table>';
    _gel("StockProfitSummary").innerHTML=sProfitTable;
  }
  function fnAddStock(Symbol){
    if(trim(Symbol).length>0){
      arrStockSymbols.push(Symbol);
      arrStockQtys.push(0);
      arrStockHi.push(0);
      arrStockLo.push(0);
      arrStockPrices.push(0);
      bPageLoaded=false;
      fnSavePrefs();
      _gel("StockAddList").style.display="none";
      fnInsertAdd();
      fnOnLoad();}
    }
  function fnDeleteStock(index){
    arrStockSymbols.splice(index,1);
    arrStockQtys.splice(index,1);
    arrStockHi.splice(index,1);
    arrStockLo.splice(index,1);
    arrStockPrices.splice(index,1);
    bPageLoaded=false;
    fnSavePrefs();
    fnOnLoad();
    fnInsertAdd();
  }
  function fnMoveStock(index,direction){
    if(direction==1){
      if(index>arrStockSymbols.length-2){return;}
        arrStockSymbols.splice(index,2,arrStockSymbols[index+1],arrStockSymbols[index]);
        arrStockQtys.splice(index,2,arrStockQtys[index+1],arrStockQtys[index]);
        arrStockHi.splice(index,2,arrStockHi[index+1],arrStockHi[index]);
        arrStockLo.splice(index,2,arrStockLo[index+1],arrStockLo[index]);
        arrStockPrices.splice(index,2,arrStockPrices[index+1],arrStockPrices[index]);
      }else{
        if(index==0){return;}
    arrStockSymbols.splice(index-1,2,arrStockSymbols[index],arrStockSymbols[index-1]);
    arrStockQtys.splice(index-1,2,arrStockQtys[index],arrStockQtys[index-1]);
    arrStockHi.splice(index-1,2,arrStockHi[index],arrStockHi[index-1]);
    arrStockLo.splice(index-1,2,arrStockLo[index],arrStockLo[index-1]);
    arrStockPrices.splice(index-1,2,arrStockPrices[index],arrStockPrices[index-1]);}
    fnSavePrefs();
    fnInsertAdd();
    fnOnLoad();
  }
  function fnSavePrefs(){
    if(arrStockSymbols.length!=0){
      pref.set("StockSymbols",arrStockSymbols.join(","));
      pref.set("StockQtys",arrStockQtys.join(","));
      pref.set("StockHi",arrStockHi.join(","));
      pref.set("StockLo",arrStockLo.join(","));
      pref.set("StockPrices",arrStockPrices.join(","));
    }else{
      pref.set("StockSymbols","GOOG");
      pref.set("StockQtys","0");
      pref.set("StockLo","0");
      pref.set("StockHi","0");
      pref.set("StockPrices","0");
    }
    pref.set("CONFIGURED","CONFIGURED");
  }
  function fnReadPrefs(){
    arrStockQtys=pref.getString("StockQtys").split(",");
    arrStockHi=pref.getString("StockHi").split(",");
    arrStockLo=pref.getString("StockLo").split(",");
    arrStockPrices=pref.getString("StockPrices").split(",");
    arrStockSymbols=pref.getString("StockSymbols").split(",");
    if(trim(arrStockSymbols[0])==""){fnToggleAdd(1);}
  }
  function fnUpdateFooterTS(){
    _gel("FooterTS").innerHTML='__MSG_lastupdated__:'+fngetDate(false);
  }
  function fnUpdateSummary(StockID){
    //print("fnUpdateSummary called");
    _gel("StockChart").innerHTML='<img width="192" height="96" src="http://ichart.finance.yahoo.com/z?s='+arrStocks[StockID][1]+'&amp;t='+pref.getString("ChartScope")+'&amp;l=off&amp;z=b">';
    _gel("SummaryChartTD").innerHTML=_gel("StockChart").innerHTML;
    _gel("SummaryNameTD").innerHTML=arrStocks[StockID][2];
    _gel("SummaryDayRangeTD").innerHTML=arrStocks[StockID][20];
    _gel("Summary52wkRangeTD").innerHTML=arrStocks[StockID][14];
    _gel("Summary200AvgTD").innerHTML=arrStocks[StockID][19];
    _gel("SummaryDayVolumeTD").innerHTML=arrStocks[StockID][12];
    _gel("SummaryLastTradeTime").innerHTML=arrStocks[StockID][7]+' '+arrStocks[StockID][8];
  }
  function fnInsertNews(content){
    var html="";
    for(var i in content.Entry){
      html+='<tr><td width="5" valign="top"><img width="16" height="16" src="'+_IG_GetImage('http://cnybroe.googlepages.com/Square.gif').src+'"></td><td><span><a href="'+_hesc(content.Entry[i].Link)+'" target="_blank">';
      html+=_hesc(content.Entry[i].Title)+'</a></span></td></tr>';
    }
    _gel("StockNews").innerHTML='<hr class="HrDef"><table border="0" cellspacing="0" cellpadding="0" width="100%" style="font-size:'+fsize+'" class="def">'+html+'</table>';
    _IG_AdjustIFrameHeight();
  }
  function fnShowTPChart(StockID){
    if(pref.getString("ChartType")=='ToolTip'){
    _gel("StockChart").style.display="block";
    }
  }
  function fnHideTPChart(sender){
    _gel("StockChart").style.display="none";
  }
  function fnToggleAdd(ForceVisible){
    if(_gel("StockAdd").style.display=="none"||ForceVisible==1){
      _gel("StockAdd").style.display="block";
      fnInsertAdd();
    }else{
      _gel("StockAdd").style.display="none";
    }
    _IG_AdjustIFrameHeight();
  }
  function fnToggleProfit(){
    //print("fnToggleProfit called");
    if(_gel("StockProfitDetails").style.display=="block"){
      _gel("StockProfitDetails").style.display="none";
    }else{
      _gel("StockProfitDetails").style.display="block";
    }
    _IG_AdjustIFrameHeight();
  }
  function fnToggleSummary(){
    //print("fnToggleSummary called");
    if(_gel("StockSummary").style.display=="none"){
      _gel("StockSummary").style.display="block";
    }else{
      _gel("StockSummary").style.display="none";
    }
    _IG_AdjustIFrameHeight();
  }
  function fnToggleNews(){
    if(_gel("StockNews").style.display=="none"){
      _gel("StockNews").innerHTML='<hr class="HrDef"><div class="loading">__MSG_loading__</div>';
      _IG_FetchFeedAsJSON('http://finance.yahoo.com/rss/headline?s='+sSymbols,fnInsertNews,5,false);
      _gel("StockNews").style.display="block";
    }else{
      _gel("StockNews").style.display="none";
    }
    _IG_AdjustIFrameHeight();
  }
  function fnHideMess(GadgetVersion){
    return function(){
      _IG_AdjustIFrameHeight();
	  pref.set("GadgetVersion",GadgetVersion);
    }
  }
  function trim(s){
    if (s){
      return s.replace(/^\s*/,"").replace(/\s*$/,"");
    }else{
      return "";
    };
  }
  function fngetDate(secs){
    var currentTime=new Date();
    var month=currentTime.getMonth()+1;
    if(month<10){month="0"+month;}
    var day=currentTime.getDate();
    if(day<10){day="0"+day;}
    var year=currentTime.getFullYear();
    var hours=currentTime.getHours();
    if(hours<10){hours="0"+hours;}
    var minutes=currentTime.getMinutes();
    if(minutes<10){minutes="0"+minutes;}
    if(secs){minutes+=':'+currentTime.getSeconds()};
    return year+'-'+month+'-'+day+' '+hours+':'+minutes;
  }
  function splitLine(inp){
    var out=[];
    var i=0;
    while(i<inp.length){
      var j=i;
      if(inp.charAt(i)=='"'){j=inp.indexOf('"',i+1);}
      var k=inp.indexOf(',',j);
      if(k<0){k=inp.length;}
      out[out.length]=inp.substring(i,k).replace(/"/gi,'');
      i=k+1;
    }
    return out;
  }
  function print(msg){
    if (debug){
      var debug_html = _gel("debug").innerHTML;
      _gel("debug").style.display='block';
      msg=fngetDate(1)+": "+_hesc(msg)+"<br>";
      debug_html=msg+debug_html;
      // Write debug HTML to div
      _gel("debug").innerHTML=debug_html;
    }
  }
  </script>
  ]]>
  </Content>
</Module>

