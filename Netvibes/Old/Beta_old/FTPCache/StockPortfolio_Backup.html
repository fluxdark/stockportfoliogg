<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:widget="http://www.netvibes.com/ns/">
    <head>
        <!-- Application Metas -->
        <title>Stock Portfolio</title>
        <meta name="author" content="Christian Nybroe" />
        <meta name="email" content="netvibes_stock+cnybroe@gmail.com" />
        <meta name="website" content="http://Netvibes.cnybroe.dk" />
        <meta name="screenshot" content="http://Netvibes.cnybroe.dk/images/StockPortfolio.png" />
        <meta name="thumbnail" content="http://Netvibes.cnybroe.dk/images/StockPortfolioThumb.png" />
        <meta name="description" content="Highly configurable list with unlimited number of stocks, options, ETFs. See chart and details for each stock. Calculate total value, earning and much more" />
        <meta name="version" content="0.1" />
        <meta name="keywords" content="stocks, quotes, quote, portfolio, finance" />
        <meta name="debugMode" content="true" />
        <meta name="apiVersion" content="2.0" />
     
        <link rel="icon" type="image/png" href="http://www.netvibes.com/favicon.ico" />
        <!-- Application Standalone emulation files -->
        <link rel="stylesheet" type="text/css" href="http://cdn.uwa.netvibes.com/lib/c/UWA/assets/css/standalone.css" />
        <script type="text/javascript" src="http://cdn.uwa.netvibes.com/lib/c/UWA/js/UWA_Standalone_Alone.js"></script>

        <!-- Application Preferences -->
        <widget:preferences>
            <widget:preference name="CustomTitle" type="text" label="Custom title" defaultValue="Stock portfolio" onchange="refresh"/>

            <widget:preference name="NameColumn" type="list" label="Name column" defaultValue="name" onchange="refresh">
                <option value="symbol" label="Symbol" />
                <option value="name" label="Name" />
                <option value="nameAndSymbol" label="Name(Symbol)" />
            </widget:preference>
            <widget:preference name="ChangeColumn" type="list" label="Change column" defaultValue="changePct" onchange="refresh">
                <option value="changePct" label="Change percent" />
                <option value="change" label="Change" />
                <option value="changeAndChangePct" label="Change(%)" />
            </widget:preference>
            <widget:preference name="Column1" type="list" label="Column 1" defaultValue="lastTrade" onchange="refresh">
                <option value="notused" label="Not used"/>
                <option value="lastTrade" label="Last trade"/>
                <option value="lastTradeDate" label="Last trade date"/>
                <option value="lastTradeTime" label="Last trade time"/>
                <option value="dayOpen" label="Day open"/>
                <option value="dayLow" label="Day low"/>
                <option value="dayHigh" label="Day high"/>
                <option value="dayVolumn" label="Day volume"/>
                <option value="previousClose" label="Previous close"/>
                <option value="fiftyTwoWeekRange" label="52 weeks range"/>
                <option value="ask" label="Ask"/>
                <option value="bid" label="Bid"/>
                <option value="tickerTrend" label="Ticker trend"/>
                <option value="fiftyDaysMovingAvg" label="50 days moving avg."/>
                <option value="twoHundredDaysMovingAvg" label="200 days moving avg."/>
                <option value="dayRange" label="Day range"/>
                <option value="currency" label="Currency"/>
                <option value="optionStrike" label="Option strike"/>
                <option value="optionCallPut" label="Option call/put"/>
                <option value="optionExpire" label="Option expire"/>
                <option value="earnedToday" label="Earned today"/>
                <option value="earned" label="Earned"/>
                <option value="price" label="Price"/>
            </widget:preference>
            <widget:preference name="Column2" type="list" label="Column 2" defaultValue="earned" onchange="refresh">
                <option value="notused" label="Not used"/>
                <option value="lastTrade" label="Last trade"/>
                <option value="lastTradeDate" label="Last trade date"/>
                <option value="lastTradeTime" label="Last trade time"/>
                <option value="dayOpen" label="Day open"/>
                <option value="dayLow" label="Day low"/>
                <option value="dayHigh" label="Day high"/>
                <option value="dayVolumn" label="Day volume"/>
                <option value="previousClose" label="Previous close"/>
                <option value="fiftyTwoWeekRange" label="52 weeks range"/>
                <option value="ask" label="Ask"/>
                <option value="bid" label="Bid"/>
                <option value="tickerTrend" label="Ticker trend"/>
                <option value="fiftyDaysMovingAvg" label="50 days moving avg."/>
                <option value="twoHundredDaysMovingAvg" label="200 days moving avg."/>
                <option value="dayRange" label="Day range"/>
                <option value="currency" label="Currency"/>
                <option value="optionStrike" label="Option strike"/>
                <option value="optionCallPut" label="Option call/put"/>
                <option value="optionExpire" label="Option expire"/>
                <option value="earnedToday" label="Earned today"/>
                <option value="earned" label="Earned"/>
                <option value="price" label="Price"/>
            </widget:preference>
            <widget:preference name="Column3" type="list" label="Column 3" defaultValue="tickerTrend" onchange="refresh">
                <option value="notused" label="Not used"/>
                <option value="lastTrade" label="Last trade"/>
                <option value="lastTradeDate" label="Last trade date"/>
                <option value="lastTradeTime" label="Last trade time"/>
                <option value="dayOpen" label="Day open"/>
                <option value="dayLow" label="Day low"/>
                <option value="dayHigh" label="Day high"/>
                <option value="dayVolumn" label="Day volume"/>
                <option value="previousClose" label="Previous close"/>
                <option value="fiftyTwoWeekRange" label="52 weeks range"/>
                <option value="ask" label="Ask"/>
                <option value="bid" label="Bid"/>
                <option value="tickerTrend" label="Ticker trend"/>
                <option value="fiftyDaysMovingAvg" label="50 days moving avg."/>
                <option value="twoHundredDaysMovingAvg" label="200 days moving avg."/>
                <option value="dayRange" label="Day range"/>
                <option value="currency" label="Currency"/>
                <option value="optionStrike" label="Option strike"/>
                <option value="optionCallPut" label="Option call/put"/>
                <option value="optionExpire" label="Option expire"/>
                <option value="earnedToday" label="Earned today"/>
                <option value="earned" label="Earned"/>
                <option value="price" label="Price"/>
            </widget:preference>
            <widget:preference name="Column4" type="list" label="Column 4" defaultValue="notused" onchange="refresh">
                <option value="notused" label="Not used"/>
                <option value="lastTrade" label="Last trade"/>
                <option value="lastTradeDate" label="Last trade date"/>
                <option value="lastTradeTime" label="Last trade time"/>
                <option value="dayOpen" label="Day open"/>
                <option value="dayLow" label="Day low"/>
                <option value="dayHigh" label="Day high"/>
                <option value="dayVolumn" label="Day volume"/>
                <option value="previousClose" label="Previous close"/>
                <option value="fiftyTwoWeekRange" label="52 weeks range"/>
                <option value="ask" label="Ask"/>
                <option value="bid" label="Bid"/>
                <option value="tickerTrend" label="Ticker trend"/>
                <option value="fiftyDaysMovingAvg" label="50 days moving avg."/>
                <option value="twoHundredDaysMovingAvg" label="200 days moving avg."/>
                <option value="dayRange" label="Day range"/>
                <option value="currency" label="Currency"/>
                <option value="optionStrike" label="Option strike"/>
                <option value="optionCallPut" label="Option call/put"/>
                <option value="optionExpire" label="Option expire"/>
                <option value="earnedToday" label="Earned today"/>
                <option value="earned" label="Earned"/>
                <option value="price" label="Price"/>
            </widget:preference>
            <widget:preference name="Column5" type="list" label="Column 5" defaultValue="notused" onchange="refresh">
                <option value="notused" label="Not used"/>
                <option value="lastTrade" label="Last trade"/>
                <option value="lastTradeDate" label="Last trade date"/>
                <option value="lastTradeTime" label="Last trade time"/>
                <option value="dayOpen" label="Day open"/>
                <option value="dayLow" label="Day low"/>
                <option value="dayHigh" label="Day high"/>
                <option value="dayVolumn" label="Day volume"/>
                <option value="previousClose" label="Previous close"/>
                <option value="fiftyTwoWeekRange" label="52 weeks range"/>
                <option value="ask" label="Ask"/>
                <option value="bid" label="Bid"/>
                <option value="tickerTrend" label="Ticker trend"/>
                <option value="fiftyDaysMovingAvg" label="50 days moving avg."/>
                <option value="twoHundredDaysMovingAvg" label="200 days moving avg."/>
                <option value="dayRange" label="Day range"/>
                <option value="currency" label="Currency"/>
                <option value="optionStrike" label="Option strike"/>
                <option value="optionCallPut" label="Option call/put"/>
                <option value="optionExpire" label="Option expire"/>
                <option value="earnedToday" label="Earned today"/>
                <option value="earned" label="Earned"/>
                <option value="price" label="Price"/>
            </widget:preference>
  
            <widget:preference name="Flashing" type="boolean" label="Flash when value change" defaultValue="true" />
            <widget:preference name="FontSize" type="range" label="Font size" defaultValue="10" step="1" min="8" max="14" />

            <!-- Hidden preferences -->
            <widget:preference name="GadgetVersion" type="hidden" defaultValue="0"/>
            <widget:preference name="StockSymbols" type="hidden" defaultValue="GOOG,MSFT"/>
            <widget:preference name="StockQtys" type="hidden" defaultValue="1,1"/>
            <widget:preference name="StockPrices" type="hidden" defaultValue="0,0"/>
            <widget:preference name="StockTC" type="hidden" defaultValue="0,0"/>
            <widget:preference name="StockHi" type="hidden" defaultValue="1000,1000"/>
            <widget:preference name="StockLo" type="hidden" defaultValue="0,0"/>
            <widget:preference name="StockExRate" type="hidden" defaultValue="1,1"/>
        </widget:preferences>

        <!-- Widget Styles -->
        <style type="text/css">
            .Loading{font-family:sans-serif;font-style:italic;font-size:11px;}
            .Footer{font-size:9px;font-family:sans-serif;padding:0px;margin:0px;}
            .HrDef{height:1px;margin-top:1px;margin-bottom:1px;margin-right:0px;margin-left:0px;}
            .def{font-family:sans-serif;}
        </style>
    
        <!-- Application JavaScript Source -->
        <script type="text/javascript">
            //https://github.com/eligrey/l10n.js/#readme
            //http://uwa.netvibes.com/docs/Uwa/html/files/Introduction-txt.html
            //http://dev.netvibes.com/doc/uwa/howto/localize_widget(It's not quite ready yet, but we plan to release a way for widget developers to make their widget strings available to translator worldwide, which will free you from having to rely on a server-side script.)

//Start of Portfolio Object:
            function Portfolio() {
                this.toString = function () {
                  return this.stocks.length;
                };
                this.stocks = []; // New Array
                //this.l10n = {"Title" : "Stock Portfolio","Loading" : "Loading...","baz" : "345678","bat" : "901234"};
                this.addStock = function (symbol, price, qty, tc, lo, hi, exRate, stockdata) {
                  var id = this.stocks.length + 1;
                  this.stocks.push(new Stock(id, symbol, price, qty, tc, lo, hi, exRate, stockdata));
                  return id;
                };
                this.stockDataColumns = 5;
                this.configuredStockDataColumns = 0;
                this.totalValue = function () {
                  var v = 0;
                  for (var i = 0; i < this.stocks.length; i++) {
                    v += this.stocks[i].value();
                  }
                  return GUI.myRoundD(v,0);
                };
                this.readPreferences = function () {
                    //needs to check for empty preferences(standalone mode)
                    var ss = widget.getValue('StockSymbols').split(',');
                    var sp = widget.getValue('StockPrices').split(',');
                    var sq = widget.getValue('StockQtys').split(',');
                    var st = widget.getValue('StockTC').split(',');
                    var sl = widget.getValue('StockLo').split(',');
                    var sh = widget.getValue('StockHi').split(',');
                    var se = widget.getValue('StockExRate').split(',');
                    for (var i = 0; i < ss.length; i++) {
                        this.addStock(ss[i], sp[i], sq[i], st[i], sl[i], sh[i], se[i]);
                    }
                }
            }
//End of Portfolio object
//Start of Stock Object:
            function Stock(id, symbol, price, qty, tc, lo, hi, exRate) {
                this.id = id;
                this.symbol = symbol;
                this.price = parseFloat(price);
                this.qty = parseInt(qty,10);
                this.tradeCost = parseFloat(tc);
                this.lo = parseFloat(lo);
                this.hi = parseFloat(hi);
                this.exRate = parseFloat(exRate);
                //Stockdata Properties
                this.updateStockData = function (stockdata) {
                    var s = parseStockData(stockdata);
                    this.name = s[2];
                    this.nameAndSymbol = s[2] + '(' + this.symbol + ')';
                    this.changePct = s[3];
                    this.change = parseFloat(s[4]);
                    this.changeAndChangePct = parseFloat(s[4]) + '(' + s[3] + ')';
                    this.changeRange = s[5];
                    this.prevLastTrade = this.lastTrade;
                    this.lastTrade = parseFloat(s[6]);
                    this.lastTradeDate = s[7];
                    this.lastTradeTime = s[8];
                    this.dayOpen = parseFloat(s[9]);
                    this.dayLow = parseFloat(s[10]);
                    this.dayHigh = parseFloat(s[11]);
                    this.dayVolume = parseFloat(s[12]);
                    this.previousClose = parseFloat(s[13]);
                    this.fiftyTwoWeekRange = s[14];
                    this.ask = parseFloat(s[15]);
                    this.bid = parseFloat(s[16]);
                    this.tickerTrend = s[17];
                    this.fiftyDaysMovingAvg = s[18];
                    this.twoHundredDaysMovingAvg = s[19];
                    this.dayRange = s[20];
                    this.optionStrike = s[21];
                    this.optionCallPut = s[22];
                    this.optionExpire = s[23];
                    this.currency = s[24];
                    this.exchange = s[25];
                    //Stock object Event triggers
                    if (s[0] == 'N/A') {
                        if (this.lastTrade > this.hi) {
                            onStockHi(this.id);
                        }
                        if (this.lastTrade < this.lo) {
                            onStockLo(this.id);
                        }
                        if (this.lastTrade != this.prevLastTrade && this.prevLastTrade != 0) {
                            onStockChange(this.id);
                        }
                    }
                };
                this.updateStockData(','); //Initialize stockdata properties with dummy values

                this.value = function () {
                    return this.qty * this.lastTrade * this.exRate;
                };
                this.totalBuyCosts = function () {
                    return GUI.myRoundD(parseFloat(this.price * this.exRate * this.qty) + parseFloat(this.tradeCost), 0);
                }; //Total costs in local currency
                this.earned = function () {
                    return GUI.myRoundD((this.lastTrade.toString().replace("%", "") * this.exRate * this.qty) - this.totalBuyCosts(), 0);
                };
                this.earnedPct = function () {
                    return GUI.myRoundD(((this.value() / this.totalBuyCosts()) - 1) * 100, 0);
                };
                this.earnedToday = function () {
                    return (isNaN(this.change)) ? 0 : GUI.myRoundD(this.change * this.qty * this.exRate, 0);
                };
                this.earnedTodayPct = function () {
                    return (isNaN(this.changePct.replace(/\%/g, "").replace(/\+/g, "").replace(/\-/g, ""))) ? 0 : GUI.myRoundD(this.changePct.replace(/\%/g, ""), 0);
                };
            }
 
            //Stock object Events
            function onStockHi(id) {
                print('Hi limit passed on index: ' + id);
            }

            function onStockLo(id) {
                print('Lo limit passed on index: ' + id);
            }

            function onStockChange(id) {
                print('Value changed on index: ' + id);
                if (widget.getBool('Flashing')==1)
                {
                    setTimeout('onStockChangeFlashOff(' + id + ')',700);
                }
            }
            function onStockChangeFlashOff(id) {
                print('Flash off on index: ' + id);
            }

            function parseStockData(inp) {
                var out = [];
                out = inp.split(/,(?=(?:[^\"]*\"[^\"]*\")*(?![^\"]*\"))/);
                for (var i = 0; i < out.length; i++) {
                    out[i] = out[i].replace(/"/g, "");
                }
                if (out.length != 26) {
                    out = 'Initializing,Bad data,Bad data,0.00%,0.00,0.00 - 0.00%,0.00,01/01/1899,12:00am,0.00,0.00,0.00,100000,0.00,"0.00 - 0.00",0.00,0.00," ====== ",+0.00%,0.00%,"0.00 - 0.00","N/A","N/A","N/A","EUR","No exchange"'.split(',');
                }
                if (out[0] != "N/A") {
                    out[24] = "???";
                    out[25] = out[0].substr(0, out[0].indexOf("<"));
                }
                return out;
            }
//End of Stock object
            
            var myPortfolio = new Portfolio();
//Start of GUI Object
            var GUI = {};
            GUI.imgBase = "http://Netvibes.cnybroe.dk/images/";
            GUI.debug = 1;
            GUI.getTagById = function (aTag, aId) {
                var tagElement = widget.body.getElementsByTagName(aTag);
                for (i = 0; i < tagElement.length; i++) {
                    if (tagElement[i].id == aId){
                        return tagElement[i];
                    }
                }
            }
            GUI.onLoad = function () {
                print('onLoad');
                
                GUI.insertFooter();
                GUI.insertDisclaimer();
                myPortfolio.readPreferences();
                
                GUI.insertStockTable();
                Quote.refreshData();
                GUI.refreshGUI();
                //GUI.setAnalytics();
                      
            
            };
            GUI.onRefresh = function () {
                print('onRefresh');
                Quote.refreshData();
            
            };
            GUI.myRoundD = function (inp, digits) {
                var x = Math.pow(10, digits);
                return Math.round(inp * x) / x;
            };
            GUI.refreshGUI = function () {
                widget.setTitle(widget.getValue('CustomTitle'));
            };
            GUI.insertFooter = function () {
                var footer = GUI.getTagById("div","Footer");
                footer.innerHTML = '<table border="0" cellspacing="0" cellpadding="1px" width="100%"><tr><td colspan="7" style="height:2px"></td></tr><tr class="Footer"><td id="FooterMsg" nowrap>' + 'Loading stocks...' + '</td><td width="20px"><img id="AddEditIcon" width="16" height="16" style="border:none;cursor:pointer;" onclick="fnToggleAdd(0)" src="' + GUI.imgBase + 'AddEdit.gif" title="' + 'Show add/edit dialog' + '"></td><td style="width:20px;"><img width="16" height="16" style="border:none;cursor:pointer" onclick="fnToggleSummary(1)" src="' + GUI.imgBase + 'Summary.gif" title="' + 'Show stock summary' + '"></td><td style="width:20px;"><img width="16" height="16" style="border:none;cursor:pointer;" onclick="fnToggleProfit(false)" src="' + GUI.imgBase + 'money.gif" title=' + 'Show profit details' + '"></td><td style="width:20px;"><img width="16" height="16" style="border:none;cursor:pointer;" onclick="fnToggleNews(1);" src="' + GUI.imgBase + 'News.gif" title="' + 'Show news' + '"/></td><td style="width:18px;"><a href="http://sites.google.com/site/cnybroe/iGoogleStockGadget/help-1" target="_blank"><img width="16" height="16" style="border:none;cursor:pointer;" src="' + GUI.imgBase + 'help.gif" title="' + 'Help' + '"></a></td><td style="width:20px;"><a href="http://ggforum.cnybroe.dk/default.aspx?g=forum&c=2" target="_blank"><img width="16" height="16" style="border:none;cursor:pointer;" src="' + GUI.imgBase + 'ggroups.gif" title="' + 'Discuss this gadget with the developer and other users' + '"></a></td></tr></table>';
            };
            GUI.insertStockTable = function () {
                var st = GUI.getTagById("div","StockData");
                var sBGColor;
                var sStockTable='<table border=0 cellspacing=0 width="100%" style="font-size:' + widget.getValue('FontSize') + ';" class="def">';
                //var arrHeaderNames=',,,%,__MSG_change__,__MSG_change__(%),__MSG_lasttrade__,__MSG_lasttradedate__,__MSG_lasttradetime__,__MSG_dayopen__,__MSG_daylow__,__MSG_dayhigh__,__MSG_dayvolume__,__MSG_previousclose__,__MSG_52weekrange__,__MSG_ask__,__MSG_bid__,__MSG_tickertrend__,__MSG_50daymovingavg__,__MSG_200daymovingavg__,__MSG_dayrange__,__MSG_optionstrike__,__MSG_optioncallput__,__MSG_optionexpire__,__MSG_currency__,,__MSG_currencyrate__,,,,__MSG_dayearned__,__MSG_earned__,,,,__MSG_buyprice__'.split(",");
                var sHead = "";
                var iConfCols = 0;

                for(i = 1; i < myPortfolio.stockDataColumns + 1; i++) {
                  var col = widget.getValue('Column' + i);
                  if(col == '') {widget.deleteValue('Column' + i);}
                  
                  if(col != 'notused' && col != '') {
                      iConfCols++;
                      sHead += '<td class="cellR">' + widget.getValue('Column' + i) + '</td>';
                  }
                }
                sStockTable+='<COLGROUP width="8px"><COLGROUP span="2" width="10%"><COLGROUP span="' + iConfCols + '" width="' + 80/iConfCols + '%"><tr style="font-weight: bold;"><td style="padding-right:8px" title="Alerts"></td><td class="cellL">Name</td><td class="cellR"><div class="Chart" id="StockChart"></div>Change</td>';
                sStockTable+=sHead;
                sStockTable+='</tr><tr style="height:1px;background-Color:BCBCBC"><td colspan=' + Number(iConfCols+3) + '></td></tr>';

                for(i = 0; i < myPortfolio.stocks.length; i++) {
                  if(i % 2 == 0){sBGColor='#FFFFFF';}else{sBGColor='#EFEFEF';}
                  sStockTable+='<tr id="str'+ i +'" style="background-Color:' + sBGColor + ';"><td class="cellL" id="stc' + i + '0"></td><td class="cellL" id="stc' + i + '1">' + myPortfolio.stocks[i].symbol + '</td>';
                  for(j = 2; j < iConfCols + 3; j++){
                    sStockTable+='<td class="cellR" id="stc'+i+j+'"></td>';
                  }
                  sStockTable+='</tr>';
                }
                sStockTable+='</table>';
                st.innerHTML = sStockTable;
                myPortfolio.configuredStockDataColumns = iConfCols;
            }
            GUI.insertDisclaimer = function () {
                var disc = GUI.getTagById("div","Disclaimer");
                disc.innerHTML = '<hr class="HrDef"/><table border="0" cellspacing="0" cellpadding="0" width="100%"><tr><td valign="middle" style="width:10%;white-space:nowrap;"><a href="http://sites.google.com/site/cnybroe/iGoogleStockGadget/disclaimer">Stock data, news and historical charts provided by </a></td><td><img alt="Yahoo Finance" src="' + GUI.imgBase + 'Y!FinanceLogo10.png"/></td></tr></table>';
            }
//End of GUI Object
//Start of Quote Object
            var Quote = {};
            Quote.refreshData = function () {
                var tags = 'e1snp2c1cl1d1t1oghvpwabt7m8m6ms3p3e3c4x';
                var symbols = ''; // = widget.getValue('Symbols');

                for (var i = 0; i < myPortfolio.stocks.length; i++) {
                    symbols += myPortfolio.stocks[i].symbol + ',';
                }
                symbols = symbols.substr(0, symbols.length - 1);
                print('Data symbols:' + symbols);

                var url = 'http://download.finance.yahoo.com/d?s=' + symbols + '&f=' + tags + '&CW=' + Math.random() * 1000;
                UWA.Data.getText(url, Quote.stockDataProxy);
            };
            Quote.stockDataProxy = function (stockData) {
                var sLines = [];
                sLines = stockData.split('\r\n');
                for (var i = 0; i < myPortfolio.stocks.length; i++) {
                    myPortfolio.stocks[i].updateStockData(sLines[i]);
                }
                for (var j = 0; j < myPortfolio.stocks.length; j++) {
                    print(myPortfolio.stocks[j].symbol + ', Qty:' + myPortfolio.stocks[j].qty + ', Price:' + myPortfolio.stocks[j].price + ', TC:' + myPortfolio.stocks[j].tradeCost + ', lo:' + myPortfolio.stocks[j].lo + ', hi:' + myPortfolio.stocks[j].hi + ', Last:' + myPortfolio.stocks[j].lastTrade);
            alert(typeof(eval('myPortfolio.stocks[j].' + widget.getValue("Column2"))));     

///Her til             
//            myPortfolio.configuredStockDataColumns
            var col = widget.getValue('Column' + i);
            if(col != 'notused' && col != '') {
              var evalStr = 'myPortfolio.stocks[j].' + widget.getValue("Column1") + '();');
              //alert(eval('myPortfolio.stocks[j].' + widget.getValue("Column2").isFunction()));
              if (typeof(eval('myPortfolio.stocks[j].' + widget.getValue("Column2"))) == 'function') {
              
              }
            }
              
            
//GUI.getTagById("td","stc" + j + "3").innerHTML = eval('(myPortfolio.stocks[j].' + widget.getValue("Column1") + ')');
GUI.getTagById("td","stc" + j + "3").innerHTML = eval('myPortfolio.stocks[j].' + widget.getValue("Column1") + '();');
GUI.getTagById("td","stc" + j + "4").innerHTML = eval('myPortfolio.stocks[j].' + widget.getValue("Column2") + '();');
                    
                }
                print('Total portfolio value:' + myPortfolio.totalValue());

            };
//End of Quote Object


//------------DEBUG CODE START-------------------
            function fngetDate(secs) {
                var currentTime = new Date();
                var month = fnZeroPad(currentTime.getMonth() + 1, 2);
                var day = fnZeroPad(currentTime.getDate(), 2);
                var year = currentTime.getFullYear();
                var hours = fnZeroPad(currentTime.getHours(), 2);
                var minutes = fnZeroPad(currentTime.getMinutes(), 2);
                if (secs) {
                    minutes += ':' + fnZeroPad(currentTime.getSeconds(), 2);
                }
                return year + '-' + month + '-' + day + ' ' + hours + ':' + minutes;
            }

            function fnZeroPad(num, length) {
                var snum = num + '';
                while (snum.length < length) {
                    snum = '0' + snum;
                }
                return snum;
            }

            function print(msg) {
                if (GUI.debug==1)
                {
                    var d = GUI.getTagById('div','Debug');
                    var d_html = d.innerHTML;
                    msg = fngetDate(1) + "; " + msg.toString() + "<br>";
                    d_html = msg + d_html;
                    d.innerHTML = d_html;
                }
            }
//------------DEBUG CODE END-------------------
            
            
//------------Widget events-------------------
            widget.addEvent('onLoad', GUI.onLoad);
            widget.addEvent('onRefresh', GUI.onRefresh);
        </script>
    </head>
    <body>
        <div id="StockData"><div class="Loading"></div></div>
        <div id="Footer" class="Footer"></div>
        <div id="Disclaimer" class="Footer"></div>
        <div id="Debug" style="display:block;font-size:8pt;padding:5px;color:red;width:100%;height:200px;overflow:scroll;white-space:nowrap;"></div> 
    </body>
</html>